<div
  class="fixed inset-0 z-0 flex flex-col overflow-hidden pb-safe-offset-14"
  hx-get="/now-playing/content"
  hx-trigger="tracklist"
  data-sse="tracklist"
  hx-target="this"
  hx-swap="morph:outerHTML"
>
  <!-- Background Blur -->
  <div
    class="fixed inset-0 -z-10 scale-110 bg-cover bg-center bg-no-repeat opacity-30 blur-3xl transition-all duration-1000"
    style="@if(playing_info.cover_image){background-image: url({{
      playing_info.cover_image
    }});}"
  ></div>

  <!-- Tablet header (hidden on phones) -->
  <div
    class="hidden pt-safe-or-4 z-10 items-center justify-between px-6 py-3 md:flex"
  >
    <button
      class="flex size-10 items-center justify-center rounded-full text-gray-400 transition-colors hover:bg-white/10 hover:text-white active:scale-95"
      onclick="history.back()"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="m15 18-6-6 6-6" />
      </svg>
    </button>
    <span
      class="text-sm font-medium tracking-widest text-gray-400 uppercase"
      >Now Playing</span
    >
    <a
      href="/queue"
      hx-target="body"
      class="flex size-10 items-center justify-center rounded-full text-gray-400 transition-colors hover:bg-white/10 hover:text-white active:scale-95"
    >
      <span class="size-6">
        @defer (icons/queue-list.html) {}
      </span>
    </a>
  </div>

  <div
    class="z-10 mx-auto flex w-full max-w-md grow flex-col justify-center gap-2 p-3 pt-safe-or-4 sm:gap-4 sm:p-6 md:max-w-4xl md:flex-row md:items-center md:gap-8 md:px-8 md:pt-0"
  >
    <!-- Artwork (flexible height on mobile, fixed width on tablet) -->
    <div
      class="relative flex min-h-0 items-center justify-center md:flex-none md:w-96"
    >
      <!-- Overlay navigation buttons (phones only) -->
      <div
        class="absolute top-0 right-0 left-0 z-10 flex justify-between p-1 md:hidden"
      >
        <button
          class="flex size-10 items-center justify-center rounded-full bg-black/20 text-gray-300 backdrop-blur-sm transition-colors hover:bg-black/40 hover:text-white active:scale-95"
          onclick="history.back()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
        </button>
        <a
          href="/queue"
          hx-target="body"
          class="flex size-10 items-center justify-center rounded-full bg-black/20 text-gray-300 backdrop-blur-sm transition-colors hover:bg-black/40 hover:text-white active:scale-95"
        >
          <span class="size-5">
            @defer (icons/queue-list.html) {}
          </span>
        </a>
      </div>

      <!-- Album art -->
      <div
        class="aspect-square max-h-full w-full overflow-hidden rounded-2xl shadow-2xl transition-transform duration-500 hover:scale-[1.02]"
      >
        @if (playing_info.cover_image) {
          <img
            src="{{ playing_info.cover_image }}"
            alt="{{ playing_info.title }}"
            class="h-full w-full object-cover"
          />
        } @else {
          <div
            class="flex h-full w-full items-center justify-center bg-gray-800 text-gray-600"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="64"
              height="64"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
              />
            </svg>
          </div>
        }
      </div>
    </div>

    <!-- Info & Controls (never clipped) -->
    <div
      class="flex shrink-0 flex-col gap-2 sm:gap-4 md:flex-1 md:shrink md:justify-center md:min-w-0"
    >
      <!-- Track Info -->
      <div class="flex flex-col gap-0.5 text-center md:text-left">
        <h1 class="truncate text-xl font-bold text-white sm:text-2xl">
          {{ playing_info.title }}
        </h1>
        <a
          href="{{ playing_info.artist_link }}"
          hx-target="body"
          class="truncate text-base font-medium text-gray-400 transition-colors hover:text-white sm:text-lg"
        >
          {{ playing_info.artist_name }}
        </a>
        <div
          class="flex items-center justify-center gap-2 text-sm text-gray-500 md:justify-start"
        >
          <a
            href="{{ playing_info.entity_link }}"
            hx-target="body"
            class="truncate transition-colors hover:text-gray-300"
          >
            {{ playing_info.entity_title }}
          </a>
          <span>&bull;</span>
          <span class="shrink-0">{{ current_position }} of {{ number_of_tracks }}</span>
          @defer (
            info.html;
            hires_available=playing_info.hires_available;
            explicit=playing_info.explicit
          ) {}
        </div>
      </div>

      <!-- Progress -->
      <div class="flex flex-col gap-2">
        @defer (
          progress.html;
          position_mseconds=position_mseconds;
          duration_mseconds=duration_mseconds;
          position_string=position_string;
          duration_string=duration_string
        ) {}
      </div>

      <!-- Controls -->
      <div class="flex items-center justify-center gap-8 md:justify-start">
        <div class="flex w-16 items-center justify-center">
          @defer (previous.html) {}
        </div>
        <div
          class="flex size-16 items-center justify-center rounded-full bg-white p-4 text-black shadow-lg transition-transform hover:scale-105 active:scale-95"
        >
          @defer (player-state.html; playing_info=playing_info) {}
        </div>
        <div class="flex w-16 items-center justify-center">
          @defer (next.html) {}
        </div>
      </div>

      <!-- Volume -->
      <div class="md:pr-4">
        @defer (volume-slider.html; current_volume=current_volume) {}
      </div>
    </div>
  </div>
</div>
