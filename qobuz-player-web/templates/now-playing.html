@defer (
  base.html;
  partial=partial;
  active_page="NowPlaying";
  playing_info=playing_info
) {
  <div
    class="relative flex h-screen w-full flex-col overflow-hidden pb-24"
    hx-get="/now-playing"
    hx-trigger="tracklist"
    data-sse="tracklist"
    hx-swap="outerHTML"
  >
    <!-- Background Blur -->
    <div
      class="fixed inset-0 -z-10 scale-110 bg-cover bg-center bg-no-repeat opacity-30 blur-3xl transition-all duration-1000"
      style="@if(playing_info.cover_image){background-image: url({{
        playing_info.cover_image
      }});}"
    ></div>

    <div
      class="z-10 mx-auto flex w-full max-w-md grow flex-col justify-between gap-6 p-6"
    >
      <!-- Header -->
      <div class="pt-safe-or-4 relative flex items-center justify-between">
        <button
          class="z-10 flex size-10 items-center justify-center rounded-full text-gray-400 transition-colors hover:bg-white/10 hover:text-white active:scale-95"
          onclick="history.back()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
        </button>
        <span
          class="pt-safe-or-4 pointer-events-none absolute inset-0 flex items-center justify-center text-xs font-medium tracking-widest text-gray-400 uppercase"
          >Now Playing</span
        >
        <a
          href="/queue"
          class="z-10 flex size-10 items-center justify-center rounded-full text-gray-400 transition-colors hover:bg-white/10 hover:text-white active:scale-95"
        >
          <span class="size-6">
            @defer (icons/queue-list.html) {}
          </span>
        </a>
      </div>

      <!-- Artwork -->
      <div class="flex aspect-square w-full justify-center px-4">
        <div
          class="relative aspect-square w-full overflow-hidden rounded-2xl shadow-2xl transition-transform duration-500 hover:scale-[1.02]"
        >
          @if (playing_info.cover_image) {
            <img
              src="{{ playing_info.cover_image }}"
              alt="{{ playing_info.title }}"
              class="h-full w-full object-cover"
            />
          } @else {
            <div
              class="flex h-full w-full items-center justify-center bg-gray-800 text-gray-600"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="64"
                height="64"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
                />
              </svg>
            </div>
          }
        </div>
      </div>

      <!-- Info & Controls -->
      <div class="flex flex-col gap-6">
        <!-- Track Info -->
        <div class="flex flex-col gap-1 text-center">
          <h1 class="truncate text-2xl font-bold text-white">
            {{ playing_info.title }}
          </h1>
          <a
            href="{{ playing_info.artist_link }}"
            class="truncate text-lg font-medium text-gray-400 transition-colors hover:text-white"
          >
            {{ playing_info.artist_name }}
          </a>
          <div
            class="flex items-center justify-center gap-2 text-sm text-gray-500"
          >
            <a
              href="{{ playing_info.entity_link }}"
              class="truncate transition-colors hover:text-gray-300"
            >
              {{ playing_info.entity_title }}
            </a>
            <span>â€¢</span>
            <span>{{ current_position }} of {{ number_of_tracks }}</span>
          </div>
        </div>

        <!-- Quality Info -->
        <div class="flex justify-center gap-2">
          @defer (
            info.html;
            hires_available=playing_info.hires_available;
            explicit=playing_info.explicit
          ) {}
        </div>

        <!-- Progress -->
        <div class="flex flex-col gap-2">
          @defer (
            progress.html;
            position_mseconds=position_mseconds;
            duration_mseconds=duration_mseconds;
            position_string=position_string;
            duration_string=duration_string
          ) {}
        </div>

        <!-- Controls -->
        <div class="flex items-center justify-center gap-8">
          <div class="flex w-16 items-center justify-center">
            @defer (previous.html) {}
          </div>
          <div
            class="flex size-16 items-center justify-center rounded-full bg-white p-4 text-black shadow-lg transition-transform hover:scale-105 active:scale-95"
          >
            @defer (player-state.html; playing_info=playing_info) {}
          </div>
          <div class="flex w-16 items-center justify-center">
            @defer (next.html) {}
          </div>
        </div>

        <!-- Volume -->
        <div class="px-4">
          @defer (volume-slider.html; current_volume=current_volume) {}
        </div>
      </div>
    </div>
  </div>
}
